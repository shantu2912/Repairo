<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FixZen - TECHNICIAN Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .premium-input { width: 100%; border: 2px solid #DFD4C3; padding: 0.85rem; border-radius: 1rem; outline: none; transition: 0.3s; }
        .btn-gold { width: 100%; padding: 1rem; background: #A07D54; color: white; border-radius: 1rem; font-weight: bold; }
        .btn-gold:disabled { opacity: 0.5; }
    </style>
</head>
<body class="bg-[#F8F5F0] p-6" x-data="{ isSubmitting: false, isSuccess: false }">

    <div class="max-w-xl mx-auto bg-white p-8 rounded-[2.5rem] shadow-xl" x-show="!isSuccess">
        <h1 class="text-2xl font-bold text-[#5D5646] mb-6 text-center">TECHNICIAN REGISTRATION</h1>
        
        <form @submit.prevent="submitTechnician($data)" class="space-y-4">
            <input type="text" id="regName" class="premium-input" placeholder="Full Name" required>
            <input type="tel" id="regPhone" class="premium-input" placeholder="Mobile (10 digits)" maxlength="10" required>
            
            <select id="regCategory" class="premium-input">
                <option>AC & Appliance Repair</option>
                <option>Electrical Specialist</option>
                <option>Master Plumber</option>
            </select>

            <div class="grid grid-cols-2 gap-4">
                <input type="number" id="regExp" class="premium-input" placeholder="Years of Exp" required>
                <input type="text" id="regAadhaar" class="premium-input" placeholder="12-Digit Aadhar" maxlength="12" required>
            </div>

            <input type="text" id="regArea" class="premium-input" placeholder="Service Area" required>

            <button type="submit" class="btn-gold" :disabled="isSubmitting">
                <span x-text="isSubmitting ? 'Sending...' : 'Submit Application'"></span>
            </button>
        </form>
    </div>

    <div x-show="isSuccess" class="text-center p-20 bg-white max-w-sm mx-auto rounded-3xl shadow-lg mt-10">
        <h2 class="text-3xl font-bold text-green-600">Success!</h2>
        <p class="mt-4">Application submitted successfully our team will you contact to you within 24 hours.</p>
        <a href="index.html" class="mt-6 inline-block text-[#A07D54] underline">Return Home</a>
    </div>

    <script>
        const supabaseUrl = "https://kzxdxnxgouthsywbsnvl.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt6eGR4bnhnb3V0aHN5d2JzbnZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzMTczMzIsImV4cCI6MjA4MTg5MzMzMn0.nqzn89vmTFKVNuZPHfGRxdTg6UHT6GMud238rr49qag";
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function submitTechnician(state) {
            state.isSubmitting = true;
            try {
                const { error } = await _supabase.from('technicians').insert([{
                    name: document.getElementById('regName').value,
                    phone: "+91" + document.getElementById('regPhone').value,
                    category: document.getElementById('regCategory').value,
                    experience: parseFloat(document.getElementById('regExp').value),
                    aadhaar: document.getElementById('regAadhaar').value,
                    area: document.getElementById('regArea').value,
                    status: 'pending'
                }]);

                if (error) throw error;
                state.isSuccess = true;
            } catch (err) {
                alert("Database Error: " + err.message);
            } finally {
                state.isSubmitting = false;
            }
        }
    </script>
</body>
</html>